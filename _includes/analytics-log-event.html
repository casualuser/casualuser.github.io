<script>
  (function () {
    if (navigator.doNotTrack === "1" || window.doNotTrack === "1") return;

    function getUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    try {
      // 1. Get/Set Anon ID (Persistent)
      var anonId = localStorage.getItem('wm_anon_id');
      if (!anonId) {
        anonId = getUUID();
        localStorage.setItem('wm_anon_id', anonId);
      }

      // 2. Get/Set Session ID (Expires on browser close ideally, or use sessionStorage)
      // For stricter 30min timeout we'd need cookies/time checks, but sessionStorage is "tab session".
      var sessionId = sessionStorage.getItem('wm_session_id');
      if (!sessionId) {
        sessionId = getUUID();
        sessionStorage.setItem('wm_session_id', sessionId);
      }

      fetch("https://pqbbjgeapylcengbuvee.functions.supabase.co/log-event", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        keepalive: true,
        body: JSON.stringify({
          path: window.location.pathname,
          referrer: document.referrer || null,
          eventType: "pageview",
          anonId: anonId,
          sessionId: sessionId
        }),
      }).catch(function () { });
    } catch (e) { }
  })();
</script>